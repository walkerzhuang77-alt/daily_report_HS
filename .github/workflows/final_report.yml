name: Aè‚¡åŒç›˜å¤ç›˜ (åˆç›˜+æ”¶ç›˜)

# è§¦å‘è§„åˆ™ï¼š
# 1. æ¯å¤© UTC 03:35 (åŒ—äº¬ 11:35) -> åˆç›˜
# 2. æ¯å¤© UTC 07:05 (åŒ—äº¬ 15:05) -> æ”¶ç›˜
# 3. æ‰‹åŠ¨è§¦å‘
on:
  schedule:
    - cron: '35 3 * * 1-5'  # å‘¨ä¸€åˆ°å‘¨äº” 03:35 (åŒ—äº¬ 11:35)
    - cron: '05 7 * * 1-5'  # å‘¨ä¸€åˆ°å‘¨äº” 07:05 (åŒ—äº¬ 15:05)
  workflow_dispatch:

jobs:
  run-market-report:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ æ‹‰å–ä»£ç 
        uses: actions/checkout@v3
      
      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–åº“
        run: pip install akshare pandas google-generativeai python-dotenv
        
      - name: ğŸš€ å¯åŠ¨äº¤æ˜“å‘˜è„šæœ¬
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          GITHUB_ACTIONS: "true"
        run: python daily_report.py
        
      - name: ğŸ”„ é‡å‘½åæŠ¥å‘Š
        run: |
          # æ‰¾åˆ°åˆšæ‰ç”Ÿæˆçš„ md æ–‡ä»¶å¹¶é‡å‘½åä¸º report.md æ–¹ä¾¿å‘é€
          mv Strategy_*.md report.md

      - name: ğŸ“§ æ¨é€åˆ°é‚®ç®±
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com # å¦‚æœæ˜¯QQè¯·æ”¹ smtp.qq.com
          server_port: 465
          secure: true
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: ğŸ“ˆ Aè‚¡å¤ç›˜å†…å‚ (${{ github.event.schedule == '35 3 * * 1-5' && 'åˆç›˜' || 'æ”¶ç›˜' }})
          to: ${{ secrets.MAIL_TO }}
          from: AI Trader <${{ secrets.MAIL_USERNAME }}>
          body: file://report.md
