name: 2.0 æ¯æ—¥Aè‚¡å¤ç›˜ (é‚®ä»¶ç‰ˆ)

on:
  schedule:
    - cron: '0 9 * * *' # åŒ—äº¬æ—¶é—´ 17:00
  workflow_dispatch:

jobs:
  run-report:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ä¸‹è½½ä»£ç 
        uses: actions/checkout@v3
      
      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pip install akshare pandas google-generativeai python-dotenv
        
      - name: ğŸš€ è¿è¡Œå¤ç›˜è„šæœ¬
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          GITHUB_ACTIONS: "true"
        run: python daily_report.py
        
      # ğŸ‘‡ æ–°å¢æ­¥éª¤ 1: æŠŠç”Ÿæˆçš„æ–‡ä»¶æ”¹ä¸ªå›ºå®šçš„åå­— (æ–¹ä¾¿å‘é‚®ä»¶)
      - name: ğŸ”„ é‡å‘½åæŠ¥å‘Š
        run: mv Strategy_*.md report.md

      # ğŸ‘‡ æ–°å¢æ­¥éª¤ 2: å‘é€é‚®ä»¶
      - name: ğŸ“§ æ¨é€åˆ°é‚®ç®±
        uses: dawidd6/action-send-mail@v3
        with:
          # é‚®ä»¶æœåŠ¡å™¨é…ç½® (è¿™é‡Œä»¥ Gmail ä¸ºä¾‹ï¼Œå¦‚æœæ˜¯ QQ/163 è¯·è‡ªè¡Œä¿®æ”¹)
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          
          # è´¦å·ä¿¡æ¯ (ä» Secrets è¯»å–)
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          
          # é‚®ä»¶å†…å®¹
          subject: ğŸ“ˆ Aè‚¡AIå¤ç›˜ç­–ç•¥æŠ¥å‘Š (GitHubæ¨é€)
          to: ${{ secrets.MAIL_TO }}
          from: GitHub Actions <${{ secrets.MAIL_USERNAME }}>
          
          # ç›´æ¥æŠŠæŠ¥å‘Šå†…å®¹ä½œä¸ºé‚®ä»¶æ­£æ–‡ï¼
          body: file://report.md
          
          # (å¯é€‰) å¦‚æœä½ æƒ³æŠŠ Markdown æ–‡ä»¶ä½œä¸ºé™„ä»¶å‘é€ï¼Œå–æ¶ˆä¸‹é¢è¿™è¡Œçš„æ³¨é‡Š
          # attachments: report.md

      # ğŸ‘‡ è¿™ä¸€æ­¥ä¿ç•™ï¼Œæ–¹ä¾¿ä½ åœ¨ GitHub ç½‘é¡µä¹Ÿèƒ½ä¸‹è½½å¤‡ä»½
      - name: ğŸ“¤ å¤‡ä»½å­˜æ¡£
        uses: actions/upload-artifact@v4
        with:
          name: æ¯æ—¥ç­–ç•¥æŠ¥å‘Š
          path: report.md
